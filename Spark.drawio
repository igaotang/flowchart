<mxfile host="app.diagrams.net" modified="2023-02-22T08:35:15.167Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36 Edg/110.0.1587.50" etag="lAqhiaffZKFBefxLEXp5" version="20.8.20" type="github" pages="2">
  <diagram name="Spark  SQL执行流程" id="dEqnPz7Te2CZXSZK34e1">
    <mxGraphModel dx="1562" dy="869" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="THCTk6hH6egYFEfsFXks-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=14;" parent="1" source="THCTk6hH6egYFEfsFXks-1" target="THCTk6hH6egYFEfsFXks-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=14;dashed=1;dashPattern=12 12;" parent="1" source="THCTk6hH6egYFEfsFXks-1" target="THCTk6hH6egYFEfsFXks-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-1" value="SparkSession#sql(String)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="50" y="30" width="210" height="40" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=14;" parent="1" source="THCTk6hH6egYFEfsFXks-4" target="THCTk6hH6egYFEfsFXks-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-4" value="DataSet#&lt;br&gt;ofRow(SparkSession,&amp;nbsp;LogicalPlan)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="40" y="635" width="230" height="40" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=14;" parent="1" source="THCTk6hH6egYFEfsFXks-6" target="THCTk6hH6egYFEfsFXks-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-6" value="AbstractSqlParser#parsePlan(String)" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="296" y="150" width="235" height="40" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;fontSize=14;" parent="1" source="THCTk6hH6egYFEfsFXks-9" target="THCTk6hH6egYFEfsFXks-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-16" value="LogicalPlan&lt;br&gt;未被解析的逻辑执行计划" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;" parent="THCTk6hH6egYFEfsFXks-15" vertex="1" connectable="0">
          <mxGeometry x="0.1929" y="-1" relative="1" as="geometry">
            <mxPoint x="29" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-9" value="AstBuilder#visitSingleStatement" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="310" y="465" width="206.5" height="40" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;fontSize=14;dashed=1;dashPattern=12 12;curved=1;strokeColor=#FF0000;" parent="1" source="THCTk6hH6egYFEfsFXks-12" target="THCTk6hH6egYFEfsFXks-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-12" value="SqlBaseParser#singleStatement" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="531" y="420" width="210" height="40" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#000000;fontSize=14;" parent="1" source="THCTk6hH6egYFEfsFXks-17" target="THCTk6hH6egYFEfsFXks-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-17" value="SessionState#executePlan(LogicalPlan&lt;span style=&quot;background-color: initial;&quot;&gt;)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="25" y="725" width="260" height="40" as="geometry" />
        </mxCell>
        <mxCell id="xvGSpYOVI_oOir4ocMuj-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="THCTk6hH6egYFEfsFXks-19" target="xvGSpYOVI_oOir4ocMuj-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-19" value="AbstractSqlParser#parse(comand: String)(SqlBaseParser =&amp;gt; &lt;span style=&quot;font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 10.5pt; color: rgb(78, 128, 125);&quot;&gt;T&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;)&lt;/span&gt;" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="241.12" y="260" width="344.25" height="40" as="geometry" />
        </mxCell>
        <mxCell id="xvGSpYOVI_oOir4ocMuj-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;curved=1;dashed=1;dashPattern=12 12;strokeColor=#FF0000;" parent="1" source="THCTk6hH6egYFEfsFXks-22" target="THCTk6hH6egYFEfsFXks-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-22" value="&lt;div&gt;parser =&amp;gt;{&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;astBuilder.visitSingleStatement(parser.singleStatement()) match {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; case plan: LogicalPlan =&amp;gt; plan&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; case _ =&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; val position = Origin(None, None)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; throw new ParseException(Option(sqlText), &quot;Unsupported SQL statement&quot;, position, position)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;先用PredictionMode.SLL进行解析，&lt;/div&gt;&lt;div&gt;失败后再用PredictionMode.LL，&lt;/div&gt;&lt;div&gt;若仍然失败则抛出异常&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="640" y="40" width="440" height="245" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-25" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.715;entryY=0.025;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;dashPattern=12 12;strokeColor=#FF0000;fontSize=14;" parent="1" source="THCTk6hH6egYFEfsFXks-24" target="THCTk6hH6egYFEfsFXks-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="340" y="700" />
              <mxPoint x="211" y="700" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-24" value="BaseSessionStateBuilder#&lt;br&gt;createQueryExecution" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="340" y="650" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#000000;fontSize=14;" parent="1" source="THCTk6hH6egYFEfsFXks-26" target="THCTk6hH6egYFEfsFXks-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-26" value="QueryExecution#analyzed" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="52.5" y="820" width="205" height="40" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#000000;fontSize=14;" parent="1" source="THCTk6hH6egYFEfsFXks-29" target="THCTk6hH6egYFEfsFXks-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-29" value="Analyzer#executeAndCheck" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="60" y="910" width="190" height="40" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-37" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#000000;fontSize=14;" parent="1" source="THCTk6hH6egYFEfsFXks-31" target="THCTk6hH6egYFEfsFXks-36" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-38" value="LogicPlan&lt;br&gt;解析后的逻辑执行计划" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;" parent="THCTk6hH6egYFEfsFXks-37" vertex="1" connectable="0">
          <mxGeometry x="-0.28" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-31" value="RuleExecutor#execute" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="80" y="1040" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeColor=#FF0000;fontSize=14;curved=1;dashed=1;dashPattern=12 12;" parent="1" source="THCTk6hH6egYFEfsFXks-33" target="THCTk6hH6egYFEfsFXks-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-33" value="程序在初始化Analysis类的时候，会初始化一些规则，然后根据这些规则来匹配执行计划，进行逻辑解析和优化" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="285" y="1010" width="209" height="80" as="geometry" />
        </mxCell>
        <mxCell id="THCTk6hH6egYFEfsFXks-36" value="DataSet" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="95" y="1180" width="115" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Hme6o7wAtb_QXtmtZKTd-1" value="" style="edgeStyle=isometricEdgeStyle;endArrow=none;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="100" relative="1" as="geometry">
            <mxPoint x="130" y="1310" as="sourcePoint" />
            <mxPoint x="180" y="1240" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-2" value="执行具体的Action时&lt;br&gt;触发逻辑计划的优化，并最终转换成到物理计划" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="Hme6o7wAtb_QXtmtZKTd-1" vertex="1" connectable="0">
          <mxGeometry x="-0.5588" y="-1" relative="1" as="geometry">
            <mxPoint x="-2" y="-15" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xvGSpYOVI_oOir4ocMuj-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="xvGSpYOVI_oOir4ocMuj-1" target="THCTk6hH6egYFEfsFXks-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xvGSpYOVI_oOir4ocMuj-1" value="val lexer = new SqlBaseLexer(new UpperCaseCharStream(CharStreams.fromString(command)))&lt;br&gt;val tokenStream = new CommonTokenStream(lexer)&lt;br&gt;new SqlBaseParser(tokenStream)" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="170" y="335" width="620" height="70" as="geometry" />
        </mxCell>
        <mxCell id="xvGSpYOVI_oOir4ocMuj-6" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;dashPattern=12 12;strokeColor=#FF0000;" parent="1" source="xvGSpYOVI_oOir4ocMuj-5" target="THCTk6hH6egYFEfsFXks-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xvGSpYOVI_oOir4ocMuj-5" value="使用基于Rule的规则解析以及Session Catalog来实现函数资源信息和元数据管理信息。&lt;br&gt;使用事先定义好的 Rule 以及 Catalog 等信息对 Unresolved LogicalPlan 进行 transform。&lt;br&gt;Catalog 主要用于各种函数资源信息和元数据信息（数据库、数据表、数据视图、数据分区与函数等）的统一管理。&lt;br&gt;&lt;div&gt;多个性质类似的 Rule 组成一个 Batch，比如上面名为 Hints 的 Batch就是由很多个 Hints Rule 组成；而多个 Batch 构成一个 batches。这些 batches 会由 RuleExecutor 执行，先按一个一个 Batch 顺序执行，然后对 Batch 里面的每个 Rule 顺序执行。每个 Batch 会执行一次（Once）或多次（FixedPoint，由&lt;/div&gt;&lt;div&gt;spark.sql.optimizer.maxIterations 参数决定）&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="330" y="790" width="560" height="150" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="dJa-XMbD3ppQLrqUtmth-1" target="dJa-XMbD3ppQLrqUtmth-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-1" value="QueryExecution#executedPlan" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="65" y="1420" width="205" height="40" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;curved=1;dashed=1;dashPattern=12 12;strokeColor=#FF0000;" parent="1" source="dJa-XMbD3ppQLrqUtmth-3" target="dJa-XMbD3ppQLrqUtmth-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="480" y="1460" />
              <mxPoint x="228" y="1460" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-9" value="SparkPlan&lt;br&gt;即为PhysicalPlan" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="dJa-XMbD3ppQLrqUtmth-8" vertex="1" connectable="0">
          <mxGeometry x="0.0215" y="15" relative="1" as="geometry">
            <mxPoint x="23" y="-15" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-3" value="&lt;div&gt;lazy val sparkPlan: SparkPlan = {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; SparkSession.setActiveSession(sparkSession)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; // TODO: We use next(), i.e. take the first plan returned by the planner, here for now,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; //&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;but we will implement to choose the best plan.&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; planner.plan(ReturnAnswer(optimizedPlan)).next()&lt;/div&gt;&lt;div&gt;&amp;nbsp; }&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="480" y="1300" width="375" height="140" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#000000;" parent="1" source="dJa-XMbD3ppQLrqUtmth-5" target="dJa-XMbD3ppQLrqUtmth-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-5" value="QueryExecution#&lt;br&gt;prepareForExecution(SparkPlan)" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="47.5" y="1532" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-11" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.997;entryY=0.571;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;dashPattern=12 12;strokeColor=#FF0000;" parent="1" source="dJa-XMbD3ppQLrqUtmth-10" target="dJa-XMbD3ppQLrqUtmth-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-12" value="Optimizer" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="dJa-XMbD3ppQLrqUtmth-11" vertex="1" connectable="0">
          <mxGeometry x="0.4033" y="-5" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-10" value="基于规则的RBO优化&lt;br&gt;lazy val optimizedPlan: LogicalPlan = sparkSession.sessionState.optimizer.execute(withCachedData)" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="980" y="1320" width="400" height="50" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-14" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;dashPattern=12 12;strokeColor=#FF0000;" parent="1" source="dJa-XMbD3ppQLrqUtmth-13" target="dJa-XMbD3ppQLrqUtmth-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-15" value="planner" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="dJa-XMbD3ppQLrqUtmth-14" vertex="1" connectable="0">
          <mxGeometry x="0.3895" y="7" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-13" value="SparkPlanner" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="667.75" y="1501.69" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-21" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;strokeColor=#000000;" parent="1" source="dJa-XMbD3ppQLrqUtmth-17" target="dJa-XMbD3ppQLrqUtmth-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-17" value="SparkStrategies" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="667.75" y="1561.69" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-22" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;strokeColor=#000000;" parent="1" source="dJa-XMbD3ppQLrqUtmth-18" target="dJa-XMbD3ppQLrqUtmth-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-18" value="QueryPlanner&lt;br&gt;把一个LogicalPlan经过处理后转换为一系列PhysicalPlan&lt;br&gt;调用next()选择第一个PhysicalPlan返回，即认为第一个PhysicalPlan是最优的" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="620" y="1621.69" width="205.5" height="100" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#000000;" parent="1" source="dJa-XMbD3ppQLrqUtmth-23" target="dJa-XMbD3ppQLrqUtmth-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-31" value="全代码生成" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="dJa-XMbD3ppQLrqUtmth-30" vertex="1" connectable="0">
          <mxGeometry x="0.2381" y="-2" relative="1" as="geometry">
            <mxPoint x="2" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-23" value="preparations.foldLeft(SparkPlan)" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="47.5" y="1754" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-26" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.708;entryY=-0.075;entryDx=0;entryDy=0;entryPerimeter=0;strokeColor=#FF0000;dashed=1;dashPattern=12 12;" parent="1" source="dJa-XMbD3ppQLrqUtmth-25" target="dJa-XMbD3ppQLrqUtmth-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-27" value="preparations" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="dJa-XMbD3ppQLrqUtmth-26" vertex="1" connectable="0">
          <mxGeometry x="-0.1244" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-25" value="&lt;div&gt;Seq(&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; PlanSubqueries(sparkSession),&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; EnsureRequirements(sparkSession.sessionState.conf),&lt;/div&gt;&lt;div&gt;&amp;nbsp; CollapseCodegenStages(sparkSession.sessionState.conf),&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ReuseExchange(sparkSession.sessionState.conf),&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ReuseSubquery(sparkSession.sessionState.conf))&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="221.74" y="1580" width="383" height="120" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#000000;" parent="1" source="dJa-XMbD3ppQLrqUtmth-28" target="dJa-XMbD3ppQLrqUtmth-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-35" value="调用其apply方法&lt;br&gt;如果支持代码生成则将PhysicalPlan&lt;br&gt;转变为WholeStageCodegenExec" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="dJa-XMbD3ppQLrqUtmth-33" vertex="1" connectable="0">
          <mxGeometry x="-0.28" y="2" relative="1" as="geometry">
            <mxPoint y="4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-28" value="CollapseCodegenStages" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="47.5" y="1840" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ulmAUWNIJSCN8ucsj58H-5" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;dashed=1;dashPattern=12 12;strokeColor=#FF0000;" parent="1" source="dJa-XMbD3ppQLrqUtmth-32" target="OyspbbeXxSc23yl87xw1-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ulmAUWNIJSCN8ucsj58H-6" value="在触发action时调用其doExecute方法&lt;br&gt;执行代码的编译动作" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="ulmAUWNIJSCN8ucsj58H-5" vertex="1" connectable="0">
          <mxGeometry x="-0.6654" relative="1" as="geometry">
            <mxPoint x="95" y="10" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="dJa-XMbD3ppQLrqUtmth-32" value="WholeStageCodegenExec&lt;br&gt;也是一种SparkPlan&lt;br&gt;其在driver端生成，但此时并未执行编译过程，后面会在executor端执行" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="47.5" y="1960" width="242.5" height="80" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-23" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#000000;" parent="1" source="OyspbbeXxSc23yl87xw1-1" target="OyspbbeXxSc23yl87xw1-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-1" value="WholeStageCodegenExec#&lt;br&gt;doExecute" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="604.75" y="2133" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="OyspbbeXxSc23yl87xw1-2" target="OyspbbeXxSc23yl87xw1-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="725" y="2338" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-6" value="返回结果为元组&lt;br&gt;(CodegenContext, WholeStageCodegenExec&lt;br&gt;)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="OyspbbeXxSc23yl87xw1-5" vertex="1" connectable="0">
          <mxGeometry x="-0.2667" y="1" relative="1" as="geometry">
            <mxPoint y="4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-2" value="WholeStageCodegenExec#&lt;br&gt;doCodeGen&lt;br&gt;生成java代码" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="605" y="2217" width="240" height="50" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-26" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#000000;" parent="1" source="OyspbbeXxSc23yl87xw1-7" target="OyspbbeXxSc23yl87xw1-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-27" value="返回结果" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="OyspbbeXxSc23yl87xw1-26" vertex="1" connectable="0">
          <mxGeometry x="-0.1803" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-7" value="CodeGenerator.compile(CodeAndComment&lt;span style=&quot;background-color: initial;&quot;&gt;)&lt;/span&gt;" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="577.5" y="2338" width="292.5" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-20" value="" style="group" parent="1" vertex="1" connectable="0">
          <mxGeometry x="1000" y="2160" width="982.5" height="440" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-19" value="" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="OyspbbeXxSc23yl87xw1-20" vertex="1">
          <mxGeometry width="982.5" height="440" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-9" value="CodeGenerator#cache.get(CodeAndComment)" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="OyspbbeXxSc23yl87xw1-20" vertex="1">
          <mxGeometry x="27.75" y="190" width="292.5" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;curved=1;dashed=1;dashPattern=12 12;strokeColor=#FF0000;" parent="OyspbbeXxSc23yl87xw1-20" source="OyspbbeXxSc23yl87xw1-11" target="OyspbbeXxSc23yl87xw1-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-11" value="&lt;div&gt;private val cache = CacheBuilder.newBuilder()&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .maximumSize(SQLConf.get.codegenCacheMaxEntries)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .build(&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; new CacheLoader[CodeAndComment, (GeneratedClass, Int)]() {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; override def load(code: CodeAndComment): (GeneratedClass, Int) = {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; val startTime = System.nanoTime()&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; val result = doCompile(code)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; val endTime = System.nanoTime()&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; def timeMs: Double = (endTime - startTime).toDouble / 1000000&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; CodegenMetrics.METRIC_SOURCE_CODE_SIZE.update(code.body.length)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; CodegenMetrics.METRIC_COMPILATION_TIME.update(timeMs.toLong)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; logInfo(s&quot;Code generated in $timeMs ms&quot;)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; result&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; })&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" parent="OyspbbeXxSc23yl87xw1-20" vertex="1">
          <mxGeometry x="362.5" y="10" width="602" height="270" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-13" value="CodeGenerator#doCompile" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="OyspbbeXxSc23yl87xw1-20" vertex="1">
          <mxGeometry x="73.38" y="390" width="201.25" height="42" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-15" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#000000;" parent="OyspbbeXxSc23yl87xw1-20" source="OyspbbeXxSc23yl87xw1-9" target="OyspbbeXxSc23yl87xw1-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-17" value="ClassBodyEvaluator&lt;br&gt;Janino是一种运行时的嵌入式Java编译器，将Java源文件编译为字节码文件，并把编译后的字节码直接加载到同一个 JVM 中运行" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" parent="OyspbbeXxSc23yl87xw1-20" vertex="1">
          <mxGeometry x="393.5" y="310" width="280" height="90" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;curved=1;dashed=1;dashPattern=12 12;strokeColor=#FF0000;" parent="OyspbbeXxSc23yl87xw1-20" source="OyspbbeXxSc23yl87xw1-17" target="OyspbbeXxSc23yl87xw1-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-7.5" y="500" as="sourcePoint" />
            <mxPoint x="-139.5" y="617" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;curved=1;dashed=1;dashPattern=12 12;strokeColor=#FF0000;" parent="1" source="OyspbbeXxSc23yl87xw1-19" target="OyspbbeXxSc23yl87xw1-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="986" y="2385" as="sourcePoint" />
            <mxPoint x="870" y="2430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-22" value="编译成字节码" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="OyspbbeXxSc23yl87xw1-21" vertex="1" connectable="0">
          <mxGeometry x="0.1099" y="-6" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-25" value="RDD[InternalRow]" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="577.5" y="2450" width="292.5" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-29" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#000000;" parent="1" source="OyspbbeXxSc23yl87xw1-28" target="dJa-XMbD3ppQLrqUtmth-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-28" value="lazy val executedPlan: SparkPlan = prepareForExecution(sparkPlan)&lt;br&gt;调用其execute方法" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="39" y="1320" width="257.5" height="45" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-36" value="通过analyzer生成多个物理计划， 经过Cost Model进行最优选择 ==》基于代价的CBO优化 ==》 最终选定得到的最优物理执行计划" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="950" y="1440" width="383" height="70" as="geometry" />
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-37" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;dashPattern=12 12;strokeColor=#FF0000;" parent="1" source="OyspbbeXxSc23yl87xw1-36" target="dJa-XMbD3ppQLrqUtmth-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="898" y="1516.69" as="sourcePoint" />
            <mxPoint x="772" y="1551.69" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-39" value="" style="edgeStyle=isometricEdgeStyle;endArrow=none;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="100" relative="1" as="geometry">
            <mxPoint x="138.75" y="2118" as="sourcePoint" />
            <mxPoint x="188.75" y="2048" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OyspbbeXxSc23yl87xw1-40" value="Executor端执行编译" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="OyspbbeXxSc23yl87xw1-39" vertex="1" connectable="0">
          <mxGeometry x="-0.5588" y="-1" relative="1" as="geometry">
            <mxPoint x="-2" y="-15" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="aiSqFYhptoILfyd779yY-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="aiSqFYhptoILfyd779yY-1" target="aiSqFYhptoILfyd779yY-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="aiSqFYhptoILfyd779yY-1" value="具体的Action执行被触发&lt;br&gt;如count()、collect()等" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="99.68" y="2130" width="182.5" height="40" as="geometry" />
        </mxCell>
        <mxCell id="aiSqFYhptoILfyd779yY-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="aiSqFYhptoILfyd779yY-2" target="aiSqFYhptoILfyd779yY-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="aiSqFYhptoILfyd779yY-2" value="Dataset#withAction&lt;br&gt;(name: String, qe: QueryExecution)(action: SparkPlan =&amp;gt; U)" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="1.7763568394002505e-15" y="2207" width="381.87" height="50" as="geometry" />
        </mxCell>
        <mxCell id="IJuBd549jqMZ3XzgCkh1-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="aiSqFYhptoILfyd779yY-4" target="IJuBd549jqMZ3XzgCkh1-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="aiSqFYhptoILfyd779yY-4" value="&lt;div&gt;SQLExecution.withNewExecutionId(sparkSession, qe) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; action(qe.executedPlan&lt;span style=&quot;background-color: initial;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="9.84" y="2316" width="362.34" height="50" as="geometry" />
        </mxCell>
        <mxCell id="aiSqFYhptoILfyd779yY-8" value="返回结果" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="141.01" y="3037" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="IJuBd549jqMZ3XzgCkh1-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="IJuBd549jqMZ3XzgCkh1-2" target="IJuBd549jqMZ3XzgCkh1-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="IJuBd549jqMZ3XzgCkh1-2" value="SQLExecution#withSQLConfPropagated" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="10.18" y="2440" width="362.34" height="50" as="geometry" />
        </mxCell>
        <mxCell id="IJuBd549jqMZ3XzgCkh1-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="IJuBd549jqMZ3XzgCkh1-4" target="IJuBd549jqMZ3XzgCkh1-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="IJuBd549jqMZ3XzgCkh1-4" value="回调SparkPlan#executeCollect()" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="66.05" y="2670" width="249.92" height="40" as="geometry" />
        </mxCell>
        <mxCell id="IJuBd549jqMZ3XzgCkh1-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="IJuBd549jqMZ3XzgCkh1-5" target="IJuBd549jqMZ3XzgCkh1-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="IJuBd549jqMZ3XzgCkh1-15" value="body" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="IJuBd549jqMZ3XzgCkh1-14" vertex="1" connectable="0">
          <mxGeometry x="0.3547" y="-3" relative="1" as="geometry">
            <mxPoint x="3" y="-17" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IJuBd549jqMZ3XzgCkh1-5" value="SQLExecution#withSQLConfPropagated" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="9.76" y="2550" width="362.34" height="50" as="geometry" />
        </mxCell>
        <mxCell id="IJuBd549jqMZ3XzgCkh1-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="IJuBd549jqMZ3XzgCkh1-6" target="IJuBd549jqMZ3XzgCkh1-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="IJuBd549jqMZ3XzgCkh1-6" value="SparkPlan#getByteArrayRdd()" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="90.97" y="2760" width="199.92" height="40" as="geometry" />
        </mxCell>
        <mxCell id="IJuBd549jqMZ3XzgCkh1-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="IJuBd549jqMZ3XzgCkh1-7" target="IJuBd549jqMZ3XzgCkh1-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="IJuBd549jqMZ3XzgCkh1-7" value="SparkPlan#execute()" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="116.35" y="2840" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="IJuBd549jqMZ3XzgCkh1-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="IJuBd549jqMZ3XzgCkh1-8" target="aiSqFYhptoILfyd779yY-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ulmAUWNIJSCN8ucsj58H-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;dashPattern=12 12;strokeColor=#FF0000;curved=1;" parent="1" source="IJuBd549jqMZ3XzgCkh1-8" target="OyspbbeXxSc23yl87xw1-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="IJuBd549jqMZ3XzgCkh1-8" value="SparkPlan#doExecute()" style="whiteSpace=wrap;html=1;fontSize=14;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="90.97" y="2930" width="199.69" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="paH7I8qUg0bJJ3d27nVu" name="SparkSession启动">
    <mxGraphModel dx="1562" dy="-300" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="-etMcBYjCISu4KRJcOCu-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="-etMcBYjCISu4KRJcOCu-1" target="-etMcBYjCISu4KRJcOCu-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-1" value="SparkSession.Builder#getOrCreate" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="40" y="1220" width="230" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="-etMcBYjCISu4KRJcOCu-3" target="-etMcBYjCISu4KRJcOCu-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-3" value="SparkContext$#getOrCreate(SparkConf)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="25" y="1310" width="260" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="-etMcBYjCISu4KRJcOCu-5" target="-etMcBYjCISu4KRJcOCu-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-9" value="SparkUI生效时&lt;br&gt;创建Web UI并绑定" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="-etMcBYjCISu4KRJcOCu-8" vertex="1" connectable="0">
          <mxGeometry x="-0.2429" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-5" value="new SparkContext(SparkConf, Boolean)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="25" y="1400" width="260" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="-etMcBYjCISu4KRJcOCu-7" target="-etMcBYjCISu4KRJcOCu-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-7" value="SparkUI$#create" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="25" y="1500" width="260" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="-etMcBYjCISu4KRJcOCu-10" target="-etMcBYjCISu4KRJcOCu-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-10" value="加载Hadoop的配置" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="25" y="1590" width="260" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="-etMcBYjCISu4KRJcOCu-13" target="-etMcBYjCISu4KRJcOCu-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-17" value="根据master的配置创建TaskScheduler" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="-etMcBYjCISu4KRJcOCu-16" vertex="1" connectable="0">
          <mxGeometry x="-0.2333" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-13" value="创建HeartbeatReceiver&lt;br&gt;用于后续TaskScheduler的创建" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="25" y="1680" width="260" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="-etMcBYjCISu4KRJcOCu-15" target="-etMcBYjCISu4KRJcOCu-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;dashPattern=12 12;curved=1;strokeColor=#FF0000;" parent="1" source="-etMcBYjCISu4KRJcOCu-15" target="-etMcBYjCISu4KRJcOCu-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-22" value="local或者&lt;br&gt;local[N/*]或者&lt;br&gt;local[N/*, N]" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="-etMcBYjCISu4KRJcOCu-21" vertex="1" connectable="0">
          <mxGeometry x="0.4308" y="-10" relative="1" as="geometry">
            <mxPoint x="-16" y="20" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-24" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;dashPattern=12 12;strokeColor=#FF0000;" parent="1" source="-etMcBYjCISu4KRJcOCu-15" target="-etMcBYjCISu4KRJcOCu-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-25" value="spark://..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="-etMcBYjCISu4KRJcOCu-24" vertex="1" connectable="0">
          <mxGeometry x="0.1038" y="8" relative="1" as="geometry">
            <mxPoint x="106" y="-17" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NuTxnQi3ZLx0hPxZxHnt-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;dashPattern=12 12;curved=1;strokeColor=#FF0000;" parent="1" source="-etMcBYjCISu4KRJcOCu-15" target="NuTxnQi3ZLx0hPxZxHnt-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="NuTxnQi3ZLx0hPxZxHnt-3" value="local-cluster[N,cores,&amp;nbsp;memory]]" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="NuTxnQi3ZLx0hPxZxHnt-2" vertex="1" connectable="0">
          <mxGeometry x="0.0838" y="1" relative="1" as="geometry">
            <mxPoint x="45" y="-9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NuTxnQi3ZLx0hPxZxHnt-5" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;dashPattern=12 12;strokeColor=#FF0000;" parent="1" source="-etMcBYjCISu4KRJcOCu-15" target="NuTxnQi3ZLx0hPxZxHnt-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="420" y="1815" />
              <mxPoint x="420" y="1970" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="NuTxnQi3ZLx0hPxZxHnt-6" value="其他情况，如：&lt;br&gt;mesos://host:port&lt;br&gt;k8s://https://host:port" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="NuTxnQi3ZLx0hPxZxHnt-5" vertex="1" connectable="0">
          <mxGeometry x="0.1477" y="5" relative="1" as="geometry">
            <mxPoint x="25" y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-15" value="SparkContext$#createTaskScheduler&lt;br&gt;返回一个带有两个元素的元组&lt;br&gt;(scheduler backend, the task scheduler)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="25" y="1790" width="260" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Xb8tw--Ex9bPkzGmWfd--2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="-etMcBYjCISu4KRJcOCu-18" target="Xb8tw--Ex9bPkzGmWfd--1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-18" value="启动Task Scheduler&lt;br&gt;会启动关联的backend" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="25" y="1890" width="260" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-20" value="(LocalSchedulerBackend, TaskSchedulerImpl)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="600" y="1630" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-etMcBYjCISu4KRJcOCu-23" value="(StandaloneSchedulerBackend, TaskSchedulerImpl)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="600" y="1720" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="NuTxnQi3ZLx0hPxZxHnt-1" value="(StandaloneSchedulerBackend, TaskSchedulerImpl)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="600" y="1828" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="NuTxnQi3ZLx0hPxZxHnt-4" value="根据masterUrl利用SPI加载对应的ExternalClusterManager，并得到相应的调度器后端和任务调度器" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="600" y="1940" width="390" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Hqz8F7PNRxAuPTztgPLw-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;dashed=1;dashPattern=12 12;curved=1;strokeColor=#FF0000;" parent="1" source="Hqz8F7PNRxAuPTztgPLw-1" target="-etMcBYjCISu4KRJcOCu-15" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="340" y="1570" />
              <mxPoint x="340" y="1760" />
              <mxPoint x="220" y="1760" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Hqz8F7PNRxAuPTztgPLw-1" value="RpcEndpoint" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="470" y="1500" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Hqz8F7PNRxAuPTztgPLw-7" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;dashPattern=12 12;strokeColor=#FF0000;" parent="1" source="Hqz8F7PNRxAuPTztgPLw-3" target="Hqz8F7PNRxAuPTztgPLw-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Hqz8F7PNRxAuPTztgPLw-3" value="LocalEndpoint" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="670" y="1460" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Hqz8F7PNRxAuPTztgPLw-9" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;dashPattern=12 12;strokeColor=#FF0000;" parent="1" source="Hqz8F7PNRxAuPTztgPLw-4" target="Hqz8F7PNRxAuPTztgPLw-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Hqz8F7PNRxAuPTztgPLw-4" value="CoarseGrainedExecutorBackend" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="670" y="1560" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Xb8tw--Ex9bPkzGmWfd--5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Xb8tw--Ex9bPkzGmWfd--1" target="Xb8tw--Ex9bPkzGmWfd--4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Xb8tw--Ex9bPkzGmWfd--1" value="创建DAGScheduler&lt;br&gt;一个高级调度层，实现了面向stage的调度。对于每个job，DAGScheduler会计算它的stage的DAG，保持跟踪RDD和stage输出被物化，并找到一个最小的调度方案将其提交给TaskScheduler" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="22.5" y="1980" width="265" height="110" as="geometry" />
        </mxCell>
        <mxCell id="Xb8tw--Ex9bPkzGmWfd--3" value="参考：&lt;a href=&quot;https://blog.csdn.net/pre_tender/article/details/98342730&quot;&gt;https://blog.csdn.net/pre_tender/article/details/98342730&lt;/a&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="390" y="1180" width="350" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Xb8tw--Ex9bPkzGmWfd--7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;dashPattern=12 12;curved=1;strokeColor=#FF0000;" edge="1" parent="1" source="Xb8tw--Ex9bPkzGmWfd--4" target="Xb8tw--Ex9bPkzGmWfd--6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Xb8tw--Ex9bPkzGmWfd--9" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#000000;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1" source="Xb8tw--Ex9bPkzGmWfd--4" target="Xb8tw--Ex9bPkzGmWfd--8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Xb8tw--Ex9bPkzGmWfd--4" value="启动MetricsSystem" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="22.5" y="2130" width="265" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Xb8tw--Ex9bPkzGmWfd--6" value="&lt;div&gt;1 注册Sources&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;指定了从哪里收集测量数据；&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;Source有两种来源：&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;- Spark internal source: MasterSource/WorkerSource等；&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;- Common source： JvmSource&lt;/div&gt;&lt;div&gt;2 注册Sinks&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;指定了往哪里输出测量数据；&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;Spark目前提供的Sink有ConsoleSink、CsvSink、JmxSink、MetricsServlet、GraphiteSink等；Spark使用MetricsServlet作为默认的Sink。&lt;/div&gt;&lt;div&gt;3 将Sinks增加Jetty的ServletContextHandler；&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="400" y="2040" width="880" height="180" as="geometry" />
        </mxCell>
        <mxCell id="Xb8tw--Ex9bPkzGmWfd--8" value="创建并启动ExecutorAllocationManager&lt;br&gt;管理分配的Executor，可以动态的分配最小Executor的数量、动态分配最大Executor的数量、每个Executor可以运行的Task数量等配置信息，并对配置信息进行校验" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="22.5" y="2290" width="265" height="110" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
